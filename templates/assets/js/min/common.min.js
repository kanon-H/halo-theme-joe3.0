window.encryption=str=>window.btoa(unescape(encodeURIComponent(str))),window.decrypt=str=>decodeURIComponent(escape(window.atob(str)));const commonContext={initMode(){if("scrollRestoration"in history&&(history.scrollRestoration="manual"),"user"!==ThemeConfig.theme_mode)return;const $html=$("html"),$icon_light=$(".mode-light"),$icon_dark=$(".mode-dark");let local_theme=localStorage.getItem("data-mode");$icon_light[`${"light"===local_theme?"remove":"add"}Class`]("active"),$icon_dark[`${"light"===local_theme?"add":"remove"}Class`]("active"),$(".joe_action_item.mode").on("click",(function(e){e.stopPropagation();try{local_theme=localStorage.getItem("data-mode");let theme="";local_theme?(theme="light"===local_theme?"dark":"light",$icon_light[`${"light"===local_theme?"add":"remove"}Class`]("active"),$icon_dark[`${"light"===local_theme?"remove":"add"}Class`]("active")):(theme="dark",$icon_light.removeClass("active"),$icon_dark.addClass("active")),$html.attr("data-mode",theme),$html.attr("data-color-scheme",theme),localStorage.setItem("data-mode",theme),commonContext.initCommentTheme(),commonContext.initSearchTheme()}catch(err){console.log(err)}}))},loadingBar:{show(){ThemeConfig.enable_loading_bar&&(NProgress.configure({easing:"ease",speed:500,showSpinner:!1}),NProgress.start())},hide(){ThemeConfig.enable_loading_bar&&NProgress.done(!0)}},initNavbar(){const $nav_menus=$(".joe_header__above-nav a"),$nav_side_menus=$(".panel-side-menu .link");let activeIndex=0;const{href:href,pathname:pathname}=location;$nav_menus.each((index,item)=>{const cur_href=item.getAttribute("href");(pathname.includes(cur_href)||href.includes(cur_href))&&(activeIndex=index)});const $curMenu=$nav_menus.eq(activeIndex);$curMenu.addClass("current"),$curMenu.parents(".joe_dropdown").length&&$curMenu.parents(".joe_dropdown").find(".joe_dropdown__link a").addClass("current"),$nav_side_menus.eq(activeIndex).addClass("current")},initFooter(){ThemeConfig.enable_footer&&"fixed"===ThemeConfig.footer_position&&$("#Joe").css("margin-bottom",$(".joe_footer").height()+30)},initCommentTheme(){const comments=document.getElementsByTagName("halo-comment"),curMode=document.querySelector("html").getAttribute("data-mode");for(let i=0;i<comments.length;i++){const shadowDom=comments[i].shadowRoot.getElementById("halo-comment");$(shadowDom)[`${"light"===curMode?"remove":"add"}Class`]("dark")}},initSearchTheme(){const curMode=document.querySelector("html").getAttribute("data-mode");document.querySelector("html").setAttribute("data-color-scheme",curMode)},initCode(isRefresh){const $codeElms=$(".page-post pre, .page-journals pre, .page-sheet pre");$codeElms.length&&$codeElms.each((function(_index,item){const $item=$(item);if($item.find("code").length>0){if(isRefresh)return void $item.find(".code-expander").off("click").on("click",(function(e){e.stopPropagation();const $this=$(this),$auto_fold=$this.parent("pre").siblings(".toolbar").find(".autofold-tip");$auto_fold&&$auto_fold.remove(),$this.parent("pre").toggleClass("close")}));if(ThemeConfig.enable_code_title&&$item.addClass("c_title"),ThemeConfig.enable_code_hr&&$item.addClass("c_hr"),ThemeConfig.enable_code_macdot&&$item.addClass("c_macdot"),ThemeConfig.enable_code_newline&&$item.addClass("c_newline"),ThemeConfig.show_tools_when_hover&&$item.addClass("c_hover_tools"),ThemeConfig.enable_code_expander&&($item.prepend('<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>').addClass("c_expander"),$item.find(".code-expander").on("click",(function(e){e.stopPropagation();const $this=$(this),$auto_fold=$this.parent("pre").siblings(".toolbar").find(".autofold-tip");$auto_fold&&$auto_fold.remove(),$this.parent("pre").toggleClass("close")}))),ThemeConfig.enable_code_copy){const text=$item.find("code[class*='language-']").text(),span=$('<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>');new ClipboardJS(span[0],{text:()=>text}).on("success",()=>Qmsg.success("复制成功！")),$item.addClass("c_copy").append(span)}}}))},foldCode(){$(".page-post").length&&ThemeConfig.enable_code_expander&&ThemeConfig.enable_fold_long_code&&"false"!==PageAttrs.metas_enable_fold_long_code&&$(".page-post pre[class*='language-']").each((function(_index,item){const $item=$(item);if($item.height()>ThemeConfig.long_code_height){$item.siblings(".toolbar").find(".toolbar-item span").eq(0).append('<em class="autofold-tip"><已自动折叠></em>'),$item.addClass("close")}}))},initBaidu(){ThemeConfig.check_baidu_collect&&$("#joe_baidu_record").length&&Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/iscollect",method:"GET",returnRaw:!0,data:{url:ThemeConfig.blog_url+window.location.pathname}}).then(res=>{if(res.data&&res.data.collected)$("#joe_baidu_record").css("color","#67c23a").html("已收录");else if(ThemeConfig.baidu_token){$("#joe_baidu_record").html('<span style="color: #e6a23c">未收录，推送中...</span>');let _timer=setTimeout((function(){Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/push",method:"POST",returnRaw:!0,data:{site:ThemeConfig.blog_url,token:ThemeConfig.baidu_token,urls:window.location.href}}).then(res=>{0===res.data.success?$("#joe_baidu_record").html('<span style="color: #f56c6c">推送失败，请检查！</span>'):$("#joe_baidu_record").html('<span style="color: #67c23a">推送成功！</span>')}).catch(err=>{console.log(err)}),clearTimeout(_timer),_timer=null}),1e3)}else{const url=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;$("#joe_baidu_record").html(`<a target="_blank" href="${url}" rel="noopener noreferrer nofollow" style="color: #f56c6c">未收录，提交收录</a>`)}}).catch(err=>{console.log(err)})},initMusic(){ThemeConfig.enable_global_music_player&&Utils.request({url:`${ThemeConfig.music_api}?server=${ThemeConfig.music_source}&type=${ThemeConfig.music_player_type}&id=${ThemeConfig.music_list_id}`,type:"GET",returnRaw:!0}).then(res=>{new APlayer({container:document.getElementById("global-aplayer"),fixed:!0,lrcType:0,theme:ThemeConfig.music_player_theme,autoplay:ThemeConfig.music_auto_play,volume:ThemeConfig.music_player_volume,loop:ThemeConfig.music_loop_play,audio:res})}).catch(err=>{console.log(err)})},initPDF(){const $pdfs=$("joe-pdf");$pdfs.length&&$pdfs.each((_index,item)=>{const $item=$(item);options={src:$item.attr("src")||"",width:$item.attr("width")||"100%",height:$item.attr("height")||"500px"};let htmlStr="";htmlStr=options.src?`\n      <div class="joe_pdf">\n        <iframe src="${ThemeConfig.BASE_RES_URL}/assets/lib/pdfjs/web/viewer.html?file=${options.src}" style="width:${options.width};height:${options.height}"></iframe>\n      </div>`:"<p>pdf地址未填写！</p>",$(item).replaceWith(htmlStr)})},back2Top(){if(!ThemeConfig.enable_back2top)return;const $el=$(".joe_action_item.back2top"),handleScroll=()=>{const scrollTop=document.documentElement.scrollTop||document.body.scrollTop;$el[(scrollTop>300?"add":"remove")+"Class"]("active")};handleScroll(),$(document).on("scroll",Utils.throttle(handleScroll,120)),$el.on("click",(function(e){e.stopPropagation(),$("html,body").animate({scrollTop:0},ThemeConfig.enable_back2top_smooth?500:0)}))},initTimeCount(){if(Joe.isMobile||!$(".joe_aside__item.timelife").length)return;let timelife=[{title:"今日已经过去",endTitle:"小时",num:0,percent:"0%"},{title:"这周已经过去",endTitle:"天",num:0,percent:"0%"},{title:"本月已经过去",endTitle:"天",num:0,percent:"0%"},{title:"今年已经过去",endTitle:"个月",num:0,percent:"0%"}];{let todayPassHours=(+new Date-new Date((new Date).toLocaleDateString()).getTime())/1e3/60/60,todayPassHoursPercent=todayPassHours/24*100;timelife[0].num=parseInt(todayPassHours),timelife[0].percent=parseInt(todayPassHoursPercent)+"%"}{let weekDay={0:7,1:1,2:2,3:3,4:4,5:5,6:6}[(new Date).getDay()],weekDayPassPercent=weekDay/7*100;timelife[1].num=parseInt(weekDay),timelife[1].percent=parseInt(weekDayPassPercent)+"%"}{let year=(new Date).getFullYear(),date=(new Date).getDate(),month=(new Date).getMonth()+1,monthPassPercent=date/new Date(year,month,0).getDate()*100;timelife[2].num=date,timelife[2].percent=parseInt(monthPassPercent)+"%"}{let month=(new Date).getMonth()+1,yearPass=month/12*100;timelife[3].num=month,timelife[3].percent=parseInt(yearPass)+"%"}let htmlStr="";timelife.forEach((item,index)=>{htmlStr+=`\n\t\t\t\t\t\t<div class="item">\n\t\t\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t\t\t${item.title}\n\t\t\t\t\t\t\t\t<span class="text">${item.num}</span>\n\t\t\t\t\t\t\t\t${item.endTitle}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="progress">\n\t\t\t\t\t\t\t\t<div class="progress-bar">\n\t\t\t\t\t\t\t\t\t<div class="progress-bar-inner progress-bar-inner-${index}" style="width: ${item.percent}"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="progress-percentage">${item.percent}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}),$(".joe_aside__item.timelife .joe_aside__item-contain").html(htmlStr)},initWeather(){!Joe.isMobile&&ThemeConfig.enable_weather&&ThemeConfig.weather_key&&$("#he-plugin-simple").length&&(window.WIDGET={CONFIG:{modules:"120",background:"5",tmpColor:"FFFFFF",tmpSize:"13",cityColor:"FFFFFF",citySize:"13",aqiColor:"FFFFFF",aqiSize:"13",weatherIconSize:"13",alertIconSize:"13",padding:"5px 5px 4px 5px",shadow:"0",language:"auto",borderRadius:"4",fixed:"true",vertical:"top",horizontal:"left",key:ThemeConfig.weather_key}},$.getScript("https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"))},initGallery(){const $allImgs=$(".page-post .joe_detail__article img:not([class]), .page-journals .joe_journal_block img:not([class]), .page-sheet img:not([class])");$allImgs.length&&$allImgs.each((function(){const $this=$(this);$this.wrap($(`<span style="display: block;" data-fancybox="Joe" href="${$this.attr("src")}"></span>`))}))},initExternalLink(){let $allLink;if("default"!==ThemeConfig.link_behavior){if($allLink=$(".joe_main_container a[href]"),!$allLink.length)return;$allLink.each((function(){const $this=$(this);if(!$this.attr("href").includes("javascript:;")){let target="";target="new"!==ThemeConfig.link_behavior||$this.attr("href").startsWith("#")?"":"_blank",$this.attr({target:target,rel:"noopener noreferrer nofollow"})}}))}else{if($allLink=$(".page-post .joe_detail__article a[href], .joe_journal_body a[href], .page-sheet .joe_detail__article a[href]"),!$allLink.length)return;$allLink.each((function(){const $this=$(this),curHref=$this.attr("href");if(!curHref.includes("javascript:;")){const target=curHref.startsWith("#")?"":"_blank";$this.attr({target:target,rel:"noopener noreferrer nofollow"})}}))}},init3dTag(){ThemeConfig.enable_tag_cloud=null!==document.querySelector(".joe_aside__item.tags-cloud"),!Joe.isMobile&&ThemeConfig.enable_tag_cloud&&"3d"===ThemeConfig.tag_cloud_type&&$(".tags-cloud-list").length&&$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/lib/3dtag/3dtag.min.js`,_res=>{const entries=[],colors=["#F8D800","#0396FF","#EA5455","#7367F0","#32CCBC","#F6416C","#28C76F","#9F44D3","#F55555","#736EFE","#E96D71","#DE4313","#D939CD","#4C83FF","#F072B6","#C346C2","#5961F9","#FD6585","#465EFB","#FFC600","#FA742B","#5151E5","#BB4E75","#FF52E5","#49C628","#00EAFF","#F067B4","#F067B4","#ff9a9e","#00f2fe","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"];$(".tags-cloud-list a").each((i,item)=>{var min,max;entries.push({label:$(item).attr("data-label"),url:$(item).attr("data-url"),target:"_blank",fontColor:colors[(min=0,max=colors.length-1,min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min)],fontSize:16})}),$("#tags-3d").svg3DTagCloud({entries:entries,width:250,height:250,radius:"65%",radiusMin:75,bgDraw:!1,fov:800,speed:.5,fontWeight:500}),$(".tags-cloud-list").remove(),$("#tags-3d .empty").remove()})},initDropMenu(){$(".joe_dropdown").each((function(index,item){const menu=$(this).find(".joe_dropdown__menu"),trigger=$(item).attr("trigger")||"click",placement=$(item).attr("placement")||$(this).height()||0;menu.css("top",placement),"hover"===trigger?$(this).hover(()=>$(this).addClass("active"),()=>$(this).removeClass("active")):($(this).on("click",(function(e){e.stopPropagation(),$(this).toggleClass("active"),$(document).one("click",()=>$(this).removeClass("active")),e.stopPropagation()})),menu.on("click",e=>e.stopPropagation()))}))},drawerMobile(){$(".joe_header__above-slideicon").on("click",(function(e){e.stopPropagation(),$(".joe_header__searchout").removeClass("active");const $html=$("html"),$mask=$(".joe_header__mask"),$slide_out=$(".joe_header__slideout");$slide_out.hasClass("active")?($html.removeClass("disable-scroll"),$mask.removeClass("active slideout"),$slide_out.removeClass("active")):(window.sessionStorage.setItem("lastScroll",$html.scrollTop()),$html.addClass("disable-scroll"),$mask.addClass("active slideout"),$slide_out.addClass("active"))}))},searchMobile(){$(".joe_header__above-searchicon").on("click",(function(e){e.stopPropagation(),$(".joe_header__slideout").removeClass("active");const $html=$("html"),$header_above=($(".joe_header__mask"),$(".joe_header__above")),$search_out=$(".joe_header__searchout");console.log($search_out),console.log($search_out.hasClass("active")),$search_out.hasClass("active")?($html.removeClass("disable-scroll"),$search_out.removeClass("active"),$header_above.removeClass("solid")):(window.sessionStorage.setItem("lastScroll",$html.scrollTop()),$html.addClass("disable-scroll"),$header_above.addClass("solid"),$search_out.addClass("active"))}))},maskClose(){$(".joe_header__mask").on("click",(function(e){e.stopPropagation();const $html=$("html");$html.removeClass("disable-scroll"),$(".joe_header__mask").removeClass("active slideout"),$(".joe_header__searchout").removeClass("active"),$(".joe_header__slideout").removeClass("active"),$(".joe_header__toc").removeClass("active"),$(".joe_header__above").removeClass("solid");const lastScroll=window.sessionStorage.getItem("lastScroll");lastScroll&&$html.scrollTop(lastScroll),window.sessionStorage.removeItem("lastScroll")})).on("touchmove",e=>e.preventDefault)},sideMenuMobile(){$(".joe_header__slideout-menu .current").parents(".panel-body").show().siblings(".panel").addClass("in"),$(".joe_header__slideout-menu .panel").on("click",(function(e){e.stopPropagation();const $this=$(this),panelBox=$this.parent().parent();panelBox.find(".panel").not($this).removeClass("in"),panelBox.find(".panel-body").not($this.siblings(".panel-body")).stop().hide("fast"),$this.toggleClass("in").siblings(".panel-body").stop().toggle("fast")}))},initHeadScroll(){if(Joe.isMobile||ThemeConfig.enable_fixed_header)return;let last_scroll_position=0,new_scroll_position=0;const $joeHeader=$(".joe_header__above"),$effectEl=$(".joe_aside_post, .joe_aside .joe_aside__item:last-child"),headerHeight=$joeHeader.height();if($effectEl)var offset1=headerHeight+15,offset2=headerHeight-60+15;document.addEventListener("scroll",Utils.throttle(()=>{window.tocPhase||(last_scroll_position=window.scrollY,new_scroll_position<last_scroll_position&&last_scroll_position>headerHeight?($joeHeader.addClass("active"),$effectEl&&$effectEl.css("top",offset2)):new_scroll_position>last_scroll_position&&($joeHeader.removeClass("active"),$effectEl&&$effectEl.css("top",offset1)),new_scroll_position=last_scroll_position)},100))},cancelSpaceScroll(){document.body.onkeydown=function(e){const elm=(e=e||window.event).target||e.srcElement;if(32===(e.keyCode||e.charCode)){if(["text","input","textarea","halo-comment"].includes(elm.tagName.toLowerCase()))return;window.event?e.returnValue=!1:e.preventDefault()}}},scrollToHash(hash,duration=0){if(!(hash=hash||window.decodeURIComponent(location.hash)))return;const headerHeight=$(".joe_header").height(),$targetEl=$(hash);if($targetEl&&$targetEl.length>0){const scrollTop=$targetEl.offset().top-headerHeight-15;duration>0?$("html,body").animate({scrollTop:scrollTop},duration):document.documentElement.scrollTop=scrollTop}},loadMouseEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.cursor_effect||$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/effect/cursor/${ThemeConfig.cursor_effect}.js`)},loadBackdropEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.backdrop||$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/effect/backdrop/${ThemeConfig.backdrop}.js`)},setFavicon(){if(!ThemeConfig.favicon)return;const favicon=new Favico,image=new Image;image.onload=function(){favicon.image(image)},image.src=ThemeConfig.favicon},offscreenTip(){if(Joe.isMobile||!ThemeConfig.enable_offscreen_tip)return;const OriginTitile=document.title;let timer=null;document.addEventListener("visibilitychange",(function(){location.href.indexOf(ThemeConfig.blog_url)>0||"/"!==location.pathname||(document.hidden?(document.title=ThemeConfig.offscreen_title_leave||"歪，你去哪里了？",clearTimeout(timer)):(document.title=ThemeConfig.offscreen_title_back||"(つェ⊂)咦，又回来了!",timer=setTimeout((function(){document.title=OriginTitile}),2e3)))}))},initBirthday(){if(!ThemeConfig.enable_birthday)return;if(!/^\d+$/.test(ThemeConfig.birthday)&&!/^(\d{4}\/\d{1,2}\/\d{1,2}\s\d{1,2}:\d{1,2}(:\d{0,2})?)$/.test(ThemeConfig.birthday))return void Qmsg.error("“自定义博客起始时间” 格式错误，请检查！");const birthDay=new Date(/^\d+$/g.test(ThemeConfig.birthday)?+ThemeConfig.birthday:ThemeConfig.birthday),$day=$(".joe_run__day"),$hour=$(".joe_run__hour"),$minute=$(".joe_run__minute"),$second=$(".joe_run__second"),getRunTime=()=>{let day=(+new Date-birthDay.getTime())/864e5,dayPast=Math.floor(day),hour=24*(day-dayPast),hourPast=Math.floor(hour),minute=60*(hour-hourPast),minutePast=Math.floor(minute),second=60*(minute-minutePast),secondPast=Math.floor(second);day=String(dayPast).padStart(2,0),hour=String(hourPast).padStart(2,0),minute=String(minutePast).padStart(2,0),second=String(secondPast).padStart(2,0),$day.html(day),$hour.html(hour),$minute.html(minute),$second.html(second)};getRunTime(),setInterval(getRunTime,1e3)},showLoadTime(){if(Joe.isMobile||!ThemeConfig.show_loaded_time)return;const consume_time=performance.now();consume_time&&console.log("%c页面加载耗时："+Math.round(consume_time)+" ms","padding: 6px 8px;color:#fff;background:linear-gradient(270deg, #4edb21, #f15206);border-radius: 3px;")},debug(){ThemeConfig.enable_debug&&new window.VConsole},clean(){$("#compatiable-checker").remove(),$("#theme-config-getter").remove(),$("#metas-getter").remove(),$("#theme-config-getter").remove(),commonContext.loadingBar.hide()}};!function(){const omits=["loadingBar","init3dTag","foldCode","loadMouseEffect","loadBackdropEffect","setFavicon","initUV","showLoadTime","debug","clean"];document.addEventListener("DOMContentLoaded",(function(){commonContext.loadingBar.show(),Object.keys(commonContext).forEach(c=>!omits.includes(c)&&commonContext[c]())})),window.addEventListener("load",(function(){1===omits.length?commonContext[omits[0]]():omits.forEach(c=>"loadingBar"!==c&&commonContext[c]&&commonContext[c]())}))}(),window.commonContext=commonContext;